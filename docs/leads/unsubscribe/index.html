<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>You're unsubscribed — Reviero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --navy:#21333E; --teal:#00D1C1; --slate:#475569; --bg:#F6F8FA; --card:#FFFFFF; --line:#E5E7EB; }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--navy);
      font:16px/1.55 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; }
    .wrap{ min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:24px; }
    .card{ width:100%; max-width:520px; background:var(--card); border:1px solid var(--line);
      border-radius:16px; padding:28px; text-align:center; box-shadow:0 8px 24px rgba(33,51,62,.06); }
    .logo{ display:flex; gap:10px; align-items:center; justify-content:center; margin-bottom:12px; color:var(--navy); }
    .logo-dot{ width:20px; height:20px; border-radius:50%; background:var(--navy); }
    h1{ margin:12px 0 8px; font-weight:300; font-size:28px; letter-spacing:-.01em; }
    p{ margin:0; color:var(--slate); }
    .icon{ width:72px; height:72px; margin:4px auto 12px; display:block; }
    .muted{ margin-top:14px; font-size:13px; color:#6B7280; }
    .line{ height:1px; background:var(--line); margin:18px 0; }
    @media (max-width:420px){ .card{padding:22px} h1{font-size:24px} }
  </style>
</head>
<body>
  <div class="wrap">
    <main class="card" role="main" aria-labelledby="title">
      <div class="logo" aria-label="Reviero">
        <span class="logo-dot" aria-hidden="true"></span>
        <strong>Reviero</strong>
      </div>

      <!-- Envelope with check icon -->
      <svg class="icon" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#00D1C1"/><stop offset="1" stop-color="#00A8A8"/>
          </linearGradient>
        </defs>
        <rect x="8" y="22" width="80" height="52" rx="8" fill="none" stroke="url(#g)" stroke-width="4"/>
        <path d="M12 28l36 24L84 28" fill="none" stroke="url(#g)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M58 66l8 8 18-18" fill="none" stroke="url(#g)" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>

      <h1 id="title">Manage your subscription</h1>
      <p id="pre-text">Sorry to see you go. If you still want to unsubscribe, please click the button below.</p>
      <button id="unsubscribeBtn" type="button" style="margin-top:14px; appearance:none; border:0; background:#00D1C1; color:#ffffff; padding:10px 16px; border-radius:10px; font-weight:600; cursor:pointer;">
        Unsubscribe
      </button>

      <div class="line" role="presentation"></div>

      <p class="muted">
        Clicked by mistake? <a href="/" style="color:var(--navy); text-decoration:underline;">Return to the website</a>.
        <!-- Or provide a resubscribe URL: <a href="/resubscribe" style="color:var(--navy); text-decoration:underline;">Subscribe again</a>. -->
      </p>
    </main>
  </div>

</div>
  <noscript>You have been unsubscribed from Reviero emails.</noscript>
<script>
  (function() {
    var btn = document.getElementById('unsubscribeBtn');
    var title = document.getElementById('title');
    var preText = document.getElementById('pre-text');

    // Allow passing webhook and email/user via URL ?webhook=...&email=...
    var params = new URLSearchParams(window.location.search);
    var WEBHOOK_URL = params.get('webhook') || '/api/unsubscribe';
    var email = params.get('email') || '';
    var userId = params.get('user') || '';

    function setBusy(busy) {
      if (!btn) return;
      btn.disabled = busy;
      btn.style.opacity = busy ? '0.7' : '1';
      btn.style.pointerEvents = busy ? 'none' : 'auto';
      btn.textContent = busy ? 'Unsubscribing…' : 'Unsubscribe';
    }

    async function sendWebhook() {
      setBusy(true);
      try {
        await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            event: 'unsubscribe',
            email: email,
            user_id: userId,
            page: window.location.href,
            ts: Date.now()
          }),
          keepalive: true
        });
      } catch (e) {
        // swallow errors; still show unsubscribed state to the user
      }
      // Update UI to unsubscribed state
      if (title) title.textContent = 'You are unsubscribed. We’re sorry to see you go.';
      if (preText) preText.textContent = 'You will no longer receive emails from us.';
      setBusy(false);
      if (btn) btn.style.display = 'none';
    }

    if (btn) {
      btn.addEventListener('click', function() {
        sendWebhook();
      });
    }
  })();
</script>
</body>
</html>